# java-tron Logging Configuration

[java-tron](https://github.com/tronprotocol/java-tron) uses Logback for logging. The logging configuration is defined in the [logback.xml](https://github.com/tronprotocol/java-tron/blob/develop/framework/src/main/resources/logback.xml) file.
java-tron will generate logback logs into:
- `./logs/tron.log` with general application logs
- `./logs/db/db.log` with db low-level related logs

For debug logs not captured in logback logs, you can refer to:
- `./logs/gc.log` with gc debug option enabled `-Xloggc:gc.log` in the start command.
- `./start.log` with start-up logs if you:
  - Start java-tron with `sh start.sh` command. Refer [start.sh](https://github.com/tronprotocol/java-tron/blob/develop/start.sh#L348)
  - Directly start FullNode.jar with `java -jar ... FullNode.jar >> start.log ...`


Notice here all mentioned file paths are relative to the java-tron service root directory.

Below is an explanation of what logs will be captured in `tron.log`, what will be captured in `db.log`, and what will not be captured in any log file.

## `tron.log`

The `tron.log` file captures general application logs. The configuration for this log file is combined defined by the `FILE` and `ASYNC` appenders. Here are the details:

- **File Location**: `./logs/tron.log`
- **Rolling Policy**:
    - **Max File Size**: 500MB
      - The `tron.log` file will not exceed 500MB in size.
    - **File Name Pattern**: `./logs/tron-%d{yyyy-MM-dd}.%i.log.gz`
      - When the tron.log file exceeds 500MB, the SizeAndTimeBasedRollingPolicy will trigger a rollover. This means that the current tron.log file will be archived and a new tron.log file will be created. The archived log file will be named according to the fileNamePattern specified
    - **Max History**: 7 days
      - This means that the logging system will retain up to 7 compressed log files before older files are deleted.
    - **Total Size Cap**: 50GB
      - If all files in the ./logs directory exceed the totalSizeCap of 50GB, the SizeAndTimeBasedRollingPolicy will start deleting the oldest archived log files to ensure that the total size of the log files does not exceed the specified cap.
- **Include Caller Data**: true
  - Caller data includes information such as the class name, method name, file name, and line number from where the logging request was issued. This can be useful for debugging purposes, as it provides more context about the source of the log message.
- **Encoder Pattern**: `%d{HH:mm:ss.SSS} %-5level [%t] [%c{1}]\(%F:%L\) %m%n`. It Specifies the pattern for formatting log messages:
    - `%d{HH:mm:ss.SSS}`: Timestamp in hours, minutes, seconds, and milliseconds.
    - `%-5level`: Log level (e.g., INFO, DEBUG) padded to 5 characters.
    - `[%t]`: Thread name.
    - `[%c{1}]`: Logger name, abbreviated to the first character.
    - `\(%F:%L\)`: File name and line number where the log statement was issued.
    - `%m%n`: The log message followed by a newline.
- **Log Level Filter**: `INFO` and above.
  This includes all runtime exceptions in Java, for example:
  - NullPointerException
  - ArrayIndexOutOfBoundsException
  - IllegalArgumentException
  - NumberFormatException
  - UnsupportedOperationException
  - ArithmeticException

### Captured logs
Logs from the following logger names:
- `app`
- `net`
- `backup`
- `discover`
- `crypto`
- `utils`
- `actuator`
- `API`
- `witness`
- `capsule`
- `VM`

In the java-tron code, logs generated by loggers using `@Slf4j(topic = "logger name")` or `LoggerFactory.getLogger("logger name")` will be captured in `tron.log`. As stdout logs not configured to redirect to the log file, the logs generated by `System.out.print...` will not be captured in `tron.log`.

## `db.log`

The `db.log` file captures database-related logs. The configuration for this log file is defined by the `DB` appender. Similar to `tron.log`, here are the details:

- **File Location**: `./logs/db/db.log`
- **Rolling Policy**:
    - **File Name Pattern**: `./logs/db/db-%d{yyyy-MM-dd}.%i.log.gz`
    - **Max File Size**: 500MB
    - **Max History**: 7 days
    - **Total Size Cap**: 50GB
- **Encoder Pattern**: `%d{HH:mm:ss.SSS} %m%n`
- **Log Level Filter**: `INFO` and above. Similar as `tron.log`, it includes all runtime exceptions in Java.

### Captured logs
Logs from the following logger names:
  - `LEVELDB`
  - `ROCKSDB`

Current java-tron use `LEVELDB`. Same with `tron.log`, logs generated by loggers using `@Slf4j(topic = "LEVELDB")` or `LoggerFactory.getLogger("LEVELDB")` will be captured in `db.log`.
It will be level db related logs, such as read/write operations, compaction, etc.

## Logs not captured in any log file

- Logs from the `tool` logger are directed to the console and not captured in any log file.
  - Only `INFO` and the above levels are output to the console.
  - This `tool` logger is used by the DbTool provided in java-tron. It is not started automatically with the java-tron FullNode. You could ignore it if you are not using the DbTool.
- Any logs below the `INFO` level are not captured in any log file.
- Any other log names not mentioned above will not be captured in any log file.

## Graceful shutdown

To handle interruptions gracefully ensuring logs are flushed properly, java-tron also configured `shutdownHook` logback.xml.
When the java-tron process receives a `SIGTERM` signal, the shutdownHook will be triggered. The shutdownHook will wait for up to 10 seconds to allow the logback system to flush all logs to the log files before the process exits.

But in case of `SIGKILL` signal, the process will not have a chance to flush the logs to the log files.
And thus may lose some logs.
This can happen in scenarios such as:
- Using kill -9 on Unix-based systems to forcefully terminate a process.
- Using Task Manager to end a process on Windows, or force quit a process on macOS.
- System crashes or power failures.
