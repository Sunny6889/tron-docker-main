version: '3'

services:
  thanos-receive:
    image: quay.io/thanos/thanos:v0.33.0
    user: root
    container_name: thanos-receive
    networks:
      - tron_network
    volumes:
      - ./receive-data:/receive/data
      - ./conf:/receive
    ports:
      - "10907:10907"
      - "10908:10908"
      - "10909:10909"
    command:
      - "receive"
      - "--tsdb.path=/receive/data"
      - "--tsdb.retention=15d" # How long to retain raw samples on local storage.
      - "--grpc-address=0.0.0.0:10907"
      - "--http-address=0.0.0.0:10909"
      - "--remote-write.address=0.0.0.0:10908"
      - "--label=receive_replica=\"0\""
      - "--label=receive_cluster=\"java-tron-mainnet\""
      - "--objstore.config-file=/receive/bucket_storage_minio.yml"
    restart: unless-stopped

  minio: # about 5G of disk space for 1 year java-tron metrics, java-tron version xxx
    image: minio/minio:RELEASE.2019-01-31T00-31-19Z
    container_name: minio
    user: root
    networks:
      - tron_network
    restart: always  # Optional: Restart policy
    ports:
      - "9000:9000"  # Map port 9000 on the host to port 9000 in the container
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: melovethanos
    volumes:
      - ./minio:/data  # Bind mount the host directory to the container
    command: server /data  # Command to run MinIO server

networks:
  tron_network:
    driver: bridge
